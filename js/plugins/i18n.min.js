!function(){"use strict";var n=!1,L={fileName:"_",fileDir:"i18n",defaultLocale:null,supportedLocales:null,currentLocale:null,langText:{},langCache:{},getText:function(e){return this.langText&&this.langText[e]?this.langText[e]:e},readSettings:function(){if(!n){var e=document.documentElement,t=e.getAttribute("data-i18n-file");null!==t&&(this.fileName=t),null!==(t=e.getAttribute("data-i18n-dir"))&&(this.fileDir=t),null===this.defaultLocale&&(this.defaultLocale=e.getAttribute("data-i18n-default")),null===this.supportedLocales&&(this.supportedLocales=e.getAttribute("data-i18n-locales"),null!==this.supportedLocales&&(this.supportedLocales=this.supportedLocales.split(",").map(function(e){return e.trim()}))),n=!0}},validateSettings:function(){return null===this.defaultLocale?(console.warn("Using [i18n] plugin without [defaultLocale / data-i18n-file] being filled in."),!1):null===this.supportedLocales?(console.warn("Using [i18n] plugin without [supportedLocales / data-i18n-locales] being filled in."),!1):!!Array.isArray(this.supportedLocales)||(console.error("Using [i18n] plugin [supportedLocales] must be an array."),!1)},onRouteLoad:function(e){this.readSettings();var t=this.validateSettings();if(this.currentLocale=null,t&&0===window.location.hash.indexOf("#/")&&(this.currentLocale=window.location.hash.split("/")[1],""!==this.currentLocale&&-1!==this.supportedLocales.indexOf(this.currentLocale)||(this.currentLocale=null)),null===this.currentLocale)return e(!1),void(window.app&&window.app.controller&&null!==window.app.controller("/:lang/")&&(window.location="#/"+this.defaultLocale+"/"));window.app&&"object"==typeof window.app.activeModel&&(window.app.activeModel.i18n_Locale=this.currentLocale),document.documentElement.lang=this.currentLocale;var n=this.fileDir+"/"+this.fileName+"."+this.currentLocale+".json",l=[this.downloadFile(n)],a=null,i=null;app.activeController&&app.activeController.settings&&app.activeController.settings.i18nFile&&(a=app.activeController.settings.i18nFile,i=this.fileDir+"/"+a+"."+this.currentLocale+".json",l.push(this.downloadFile(i))),Promise.all(l).finally(function(){L.langText=i?app.deepClone({},L.langCache[n],L.langCache[i]):L.langCache[n],e()})},downloadFile:function(n){return void 0!==this.langCache[n]?new Promise(function(e){e()}):fetch(n,{cache:"no-store",credentials:"same-origin",headers:window.app&&window.app.getRequestHeaders?window.app.getRequestHeaders(n):{}}).then(function(e){var t=e.status;if(200<=t&&t<300||304===t)return Promise.resolve(e);var n="Error loading data. Server Response Code: "+t+", Response Text: "+e.statusText;return Promise.reject(n)}).then(function(e){return e.json()}).then(function(e){L.langCache[n]=e}).catch(function(e){var t="Error Downloading I18N file: ["+n+"], Response Code Status: "+e.message;console.error(t),L.langCache[n]={}})},onRendered:function(e){var t,n,l,a,i,r,o,s,u,c,d,h,p,g,f,w;for(o=0,s=(t=(e=e||document).querySelectorAll("[data-i18n]")).length;o<s;o++)l=(n=t[o]).getAttribute("data-i18n"),n.textContent=this.langText[l]?this.langText[l]:l;for(o=0,s=(t=e.querySelectorAll("[data-i18n-attr]")).length;o<s;o++){for(p=0,g=(h=(n=t[o]).getAttribute("data-i18n-attr").split(",").map(function(e){return e.trim()})).length;p<g;p++)f=h[p],null!==(l=n.getAttribute(f))&&n.setAttribute(f,this.langText[l]?this.langText[l]:l);null!==n.getAttribute("data-control")&&app.loadJsControl(n)}for(o=0,s=(t=e.querySelectorAll("a[data-i18n-href]")).length;o<s;o++)h=(n=t[o]).getAttribute("href").split("/"),-1!==n.getAttribute("href").indexOf("#/")&&1<h.length&&(h[1]=this.currentLocale,n.href=h.join("/"));for(o=0,s=(t=e.querySelectorAll("a[data-i18n-locales]")).length;o<s;o++)c=(n=t[o]).getAttribute("data-i18n-locales").split(",").map(function(e){return e.trim()}),d=this.currentLocale,-1===c.indexOf(d)&&(d=-1!==c.indexOf(this.defaultLocale)?this.defaultLocale:c[0]),u=new RegExp("\\[locale]","g"),n.href=n.href.replace(u,d);for(o=0,s=(t=e.querySelectorAll("[data-i18n-replace-text]")).length;o<s;o++){for(l in i=(n=t[o]).innerHTML,this.langText)this.langText.hasOwnProperty(l)&&(r="[[i18n "+l+"]]",-1!==i.indexOf(r)&&(r="\\[\\[i18n "+l+"]]",u=new RegExp(r,"g"),a=this.langText[l]?this.langText[l]:l,i=i.replace(u,a)));n.innerHTML=i}for(o=0,s=(t=document.querySelectorAll("[data-i18n-nav-lang]")).length;o<s;o++)w=(n=t[o]).getAttribute("data-i18n-nav-lang"),n.href=window.location.hash.replace("#/"+L.currentLocale+"/","#/"+w+"/");for(o=0,s=(t=document.querySelectorAll("[data-i18n-nav-selected]")).length;o<s;o++)t[o].textContent=L.currentLocale.toUpperCase()},setup:function(){window.Handlebars&&Handlebars.registerHelper("i18n",function(e,t){return void 0===t?(console.warn("Warning {{i18n}} is not being called with correct parameters, expected {{i18n key}}, parameters:"),console.log(e),console.log(t),"Error"):L.langText&&L.langText[e]?L.langText[e]:e}),window.Vue&&(Vue.directive("i18n",{bind:function(e,t){var n=t.value;e.textContent=L.langText&&L.langText[n]?L.langText[n]:n}}),Vue.directive("i18n-attr",{bind:function(e,t){for(var n=t.value.split(",").map(function(e){return e.trim()}),l=0,a=n.length;l<a;l++){var i=e.getAttribute(n[l]);null!==i&&e.setAttribute(n[l],L.langText[i]?L.langText[i]:i)}}}))}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",L.setup):L.setup(),app.addPlugin("i18n",L)}();