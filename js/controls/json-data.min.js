!function(){"use strict";var n={data:{url:"",isLoading:!1,isLoaded:!1,hasError:!1,errorMessage:null,modelProp:null,refreshTimeInterval:null,intervalID:null,clickSelector:null,graphqlId:null,graphqlSrc:null,graphqlQuery:null,errorTextGraphQLErrors:"{count} GraphQL Errors occured. See console for full details."},onFetch:null,onError:null,fetchData:function(o,e){var r,l=this,a=null,t=null;l.isLoading||(l.isLoading=!0,l.isLoaded=!1,l.hasError=!1,null!==l.modelProp&&(app.activeModel[l.modelProp]=app.activeModel[l.modelProp]||{},a=app.activeModel[l.modelProp],Object.assign(a,l)),n.renderControl(o,l),l.graphqlQuery?(r=l.url?l.url:app.settings.graphqlUrl,t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:l.graphqlQuery,variables:app.buildGraphQLVariables(l.graphqlQuery,app.activeModel)})}):r=app.buildUrl(l.url,app.activeModel),app.fetch(r,t).then(function(r){if("object"!=typeof r&&null!==r)throw new TypeError("Invalid Response type. Received data in format of ["+typeof r+"]");if(l.isLoading=!1,l.isLoaded=!0,l.hasError=!1,l.errorMessage=null,l.graphqlQuery){if(null===a?Object.assign(l,r.data):(Object.assign(a,l),Object.assign(a,r.data)),r.errors&&r.errors.length)throw 1===r.errors.length&&r.errors[0].message?"[GraphQL Error]: "+r.errors[0].message:l.errorTextGraphQLErrors.replace("{count}",r.errors.length)}else null===a?Object.assign(l,r):(Object.assign(a,l),Object.assign(a,r));n.renderControl(o,l),null!==n.onFetch&&n.onFetch.call(l,o),void 0!==e&&e()}).catch(function(r){l.isLoading=!1,l.isLoaded=!1,l.hasError=!0,l.errorMessage=r,null!==a&&Object.assign(a,l),n.renderControl(o,l,r),null!==n.onError&&n.onError.call(l,o),void 0!==e&&e()}))},renderControl:function(r,o,e){var l,a;a=o,null!==(l=r).querySelector(".is-loading, is-loaded, .has-error")&&(app.loadCss("dataformsjs-control-json-data",".dataformsjs-control-loading .is-loaded { display:none; } .dataformsjs-control-loading .has-error { display:none; } .dataformsjs-control-loaded .is-loading { display:none; } .dataformsjs-control-loaded .has-error { display:none; } .dataformsjs-control-error .is-loading { display:none; } .dataformsjs-control-error .is-loaded { display:none; }"),l.classList.remove("dataformsjs-control-loading"),l.classList.remove("dataformsjs-control-error"),l.classList.remove("dataformsjs-control-loaded"),a.isLoading?l.classList.add("dataformsjs-control-loading"):a.isLoaded?l.classList.add("dataformsjs-control-loaded"):a.hasError&&l.classList.add("dataformsjs-control-error")),null!==r.getAttribute("data-template-id")||null!==r.getAttribute("data-template-url")?null===o.modelProp?app.refreshHtmlControl(r,void 0,o):app.refreshHtmlControl(r):void 0===e?app.refreshPlugins(r):app.showError(r,e)},onLoad:function(o){var e=this;this.graphqlId||this.graphqlSrc?(this.url||(this.url=app.settings.graphqlUrl),app.getGraphQL(e.graphqlId,e.graphqlSrc).then(function(r){e.graphqlQuery=r,n.setupControl(e,o)}).catch(function(r){app.showErrorAlert(r),n.setupControl(e,o)})):n.setupControl(e,o)},setupControl:function(r,o){if(null===r.clickSelector)n.fetchData.call(r,o),null!==r.refreshTimeInterval&&(r.intervalID=window.setInterval(function(){n.fetchData.call(r,o)},r.refreshTimeInterval));else{var e=document.querySelector(r.clickSelector);if(null===e){var l="Element not found for <json-data> Control using [data-click-selector]: "+String(r.clickSelector);app.showErrorAlert(l)}else e.addEventListener("click",function(){"boolean"==typeof e.disabled&&(e.disabled=!0),n.fetchData.call(r,o,function(){"boolean"==typeof e.disabled&&(e.disabled=!1)})})}},onUnload:function(){null!==this.intervalID&&window.clearInterval(this.intervalID)}};app.addControl("json-data",n)}();