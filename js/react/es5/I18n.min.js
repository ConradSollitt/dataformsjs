"use strict";function _instanceof(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function _classCallCheck(e,t){if(!_instanceof(e,t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var I18n=function(){function l(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"_",n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"i18n";if(_classCallCheck(this,l),"string"!=typeof e)throw new Error("Error - I18n - Missing default locale See examples for usage.");if(!Array.isArray(t))throw new Error("Error - I18n - Missing or invalid supported locales. See examples for usage.");this.state={fileName:a,fileDir:n,defaultLocale:e,supportedLocales:t,currentLocale:null,langText:{},langCache:{},startCallback:null,loadedCallback:null},window.addEventListener("hashchange",this.onHashChange.bind(this)),this.onHashChange()}return _createClass(l,[{key:"onLangStart",value:function(e){this.state.startCallback=e}},{key:"onLangLoaded",value:function(e){this.state.loadedCallback=e}},{key:"onHashChange",value:function(){var n=this,l=this.state,e=null;if(0===window.location.hash.indexOf("#/")&&(""!==(e=window.location.hash.split("/")[1])&&-1!==l.supportedLocales.indexOf(e)||(e=null)),null===e&&(e=l.defaultLocale),l.currentLocale!==e){l.currentLocale=e,this.state.startCallback&&this.state.startCallback();var r=l.fileDir+"/"+l.fileName+"."+l.currentLocale+".json";if(void 0!==l.langCache[r])l.langText=l.langCache[r],n.updatePageTitle(),l.loadedCallback&&l.loadedCallback();else if(void 0!==window.fetch)fetch(r,{mode:"cors",cache:"no-store",credentials:"same-origin"}).then(function(e){var t=e.status;if(200<=t&&t<300||304===t)return Promise.resolve(e);var a="Error loading data. Server Response Code: "+t+", Response Text: "+e.statusText;return Promise.reject(a)}).then(function(e){return e.json()}).then(function(e){l.langCache[r]=e}).catch(function(e){var t="Error Downloading I18N file: ["+r+"], Response Code Status: "+e.message;console.error(t),l.langCache[r]={}}).finally(function(){l.langText=l.langCache[r],n.updatePageTitle(),l.loadedCallback&&l.loadedCallback()});else{var t=new XMLHttpRequest;t.open("GET",r),t.onload=function(){var t=null;try{var e=this.status;200<=e&&e<300||304===e?l.langCache[r]=JSON.parse(this.responseText):t="Response Status Code: "+e}catch(e){t=e.toString()}if(null!==t){var a="Error Downloading I18N file: ["+r+"], Error: "+t;console.error(a),l.langCache[r]={}}l.langText=l.langCache[r],n.updatePageTitle(),l.loadedCallback&&l.loadedCallback()},t.send()}}}},{key:"updatePageTitle",value:function(){var e=document.querySelector("html title[data-i18n]");e&&(e.textContent=this.text(e.getAttribute("data-i18n"))),document.documentElement.lang=this.state.currentLocale}},{key:"text",value:function(e){return this.state.langText&&this.state.langText[e]?this.state.langText[e]:e}},{key:"currentLocale",get:function(){return this.state.currentLocale}},{key:"getUserDefaultLang",get:function(){if(navigator.languages&&navigator.languages.length&&this.state.supportedLocales&&this.state.supportedLocales.length)for(var e=0,t=navigator.languages.length;e<t;e++)if(-1!==this.state.supportedLocales.indexOf(navigator.languages[e]))return navigator.languages[e];return this.state.defaultLocale}}]),l}();exports.default=I18n;