"use strict";function _instanceof(e,a){return null!=a&&"undefined"!=typeof Symbol&&a[Symbol.hasInstance]?!!a[Symbol.hasInstance](e):e instanceof a}function _classCallCheck(e,a){if(!_instanceof(e,a))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,a){for(var t=0;t<a.length;t++){var n=a[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,a,t){return a&&_defineProperties(e.prototype,a),t&&_defineProperties(e,t),e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var I18n=function(){function l(e,a){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"_",n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"i18n";if(_classCallCheck(this,l),"string"!=typeof e)throw new Error("Error - I18n - Missing default locale See examples for usage.");if(!Array.isArray(a))throw new Error("Error - I18n - Missing or invalid supported locales. See examples for usage.");this.state={fileName:t,fileDir:n,defaultLocale:e,supportedLocales:a,currentLocale:null,langText:{},langCache:{},startCallback:null,loadedCallback:null},window.addEventListener("hashchange",this.onHashChange.bind(this)),this.onHashChange()}return _createClass(l,[{key:"onLangStart",value:function(e){this.state.startCallback=e}},{key:"onLangLoaded",value:function(e){this.state.loadedCallback=e}},{key:"onHashChange",value:function(){var n=this,l=this.state,e=null;if(0===window.location.hash.indexOf("#/")&&(""!==(e=window.location.hash.split("/")[1])&&-1!==l.supportedLocales.indexOf(e)||(e=null)),null===e&&(e=l.defaultLocale),l.currentLocale!==e){l.currentLocale=e,this.state.startCallback&&this.state.startCallback();var r=l.fileDir+"/"+l.fileName+"."+l.currentLocale+".json";if(void 0!==l.langCache[r])l.langText=l.langCache[r],n.updatePageTitle(),l.loadedCallback&&l.loadedCallback();else if(void 0!==window.fetch)fetch(r,{mode:"cors",cache:"no-store",credentials:"same-origin"}).then(function(e){var a=e.status;if(200<=a&&a<300||304===a)return Promise.resolve(e);var t="Error loading data. Server Response Code: "+a+", Response Text: "+e.statusText;return Promise.reject(t)}).then(function(e){return e.json()}).then(function(e){l.langCache[r]=e}).catch(function(e){var a="Error Downloading I18N file: ["+r+"], Response Code Status: "+e.message;console.error(a),l.langCache[r]={}}).finally(function(){l.langText=l.langCache[r],n.updatePageTitle(),l.loadedCallback&&l.loadedCallback()});else{var a=new XMLHttpRequest;a.open("GET",r),a.onload=function(){var a=null;try{var e=this.status;200<=e&&e<300||304===e?l.langCache[r]=JSON.parse(this.responseText):a="Response Status Code: "+e}catch(e){a=e.toString()}if(null!==a){var t="Error Downloading I18N file: ["+r+"], Error: "+a;console.error(t),l.langCache[r]={}}l.langText=l.langCache[r],n.updatePageTitle(),l.loadedCallback&&l.loadedCallback()},a.send()}}}},{key:"updatePageTitle",value:function(){var e=document.querySelector("html title[data-i18n]");e&&(e.textContent=this.text(e.getAttribute("data-i18n")))}},{key:"text",value:function(e){return this.state.langText&&this.state.langText[e]?this.state.langText[e]:e}},{key:"currentLocale",get:function(){return this.state.currentLocale}},{key:"getUserDefaultLang",get:function(){if(navigator.languages&&navigator.languages.length&&this.state.supportedLocales&&this.state.supportedLocales.length)for(var e=0,a=navigator.languages.length;e<a;e++)if(-1!==this.state.supportedLocales.indexOf(navigator.languages[e]))return navigator.languages[e];return this.state.defaultLocale}}]),l}();exports.default=I18n;