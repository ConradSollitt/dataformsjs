"use strict";function _instanceof(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!_instanceof(t,e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}void 0===window.exports&&(window.exports=window),Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var dataCache=[];function saveDataToCache(t,e,r){for(var n=0,a=dataCache.length;n<a;n++){var o=dataCache[n];if(o.url===t)return o.params=JSON.stringify(e),void(o.data=r)}dataCache.push({url:t,params:JSON.stringify(e),data:r})}function getDataFromCache(t,e){for(var r=0,n=dataCache.length;r<n;r++){var a=dataCache[r];if(a.url===t){if(JSON.stringify(e)===a.params)return a.data;break}}return null}function IsLoading(t){return 0===t.fetchState&&t.children?t.children:null}function HasError(t){if(!(-1===t.fetchState)||!t.children)return null;var e=t.error;return"string"==typeof e&&-1===e.indexOf("Error")&&(e="Error - "+e),React.cloneElement(t.children,{error:e})}function IsLoaded(t){return 1===t.fetchState?React.cloneElement(t.children,{data:t.data,params:t.params,handleChange:t.handleChange}):null}var JsonData=function(){function r(t){var e;return _classCallCheck(this,r),(e=_possibleConstructorReturn(this,_getPrototypeOf(r).call(this,t)))._isFetching=!1,e._isMounted=!1,e.fetchData=e.fetchData.bind(_assertThisInitialized(e)),e.handleChange=e.handleChange.bind(_assertThisInitialized(e)),e.state={fetchState:0,error:null,params:e.getUrlParams(),data:null},e}return _inherits(r,React.Component),_createClass(r,[{key:"getUrlParams",value:function(){var t={};for(var e in this.props)"url"!==e&&"string"==typeof this.props[e]&&(t[e]=this.props[e]);return t}},{key:"componentDidMount",value:function(){if(this._isMounted=!0,this.props.loadOnlyOnce){var t=getDataFromCache(this.props.url,this.getUrlParams());if(null!==t)return void this.setState({fetchState:1,data:t})}this.fetchData()}},{key:"componentDidUpdate",value:function(t,e){this.buildUrl(e.params)!==this.buildUrl(this.props)&&this.setState({params:this.getUrlParams()},this.fetchData)}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"buildUrl",value:function(t){var e=this.props.url;if(0<Object.keys(t).length)for(var r in t)-1<e.indexOf(":"+r)&&(e=e.replace(new RegExp(":"+r,"g"),encodeURIComponent(t[r])));return e}},{key:"fetchData",value:function(){var e=this,t=this.buildUrl(this.state.params);if(!this._isFetching){this._isFetching=!0;var r={mode:"cors",cache:"no-store",credentials:"same-origin"};this.props.fetchOptions&&(r=this.props.fetchOptions),this.props.fetchHeaders&&(r.headers=this.props.fetchHeaders),this.setState({fetchState:0},function(){fetch(t,r).then(function(t){var e=t.status;if(200<=e&&e<300||304===e)return Promise.resolve(t);var r="Error loading data. Server Response Code: "+e+", Response Text: "+t.statusText;return Promise.reject(r)}).then(function(t){return t.json()}).then(function(t){e._isMounted&&e.setState({fetchState:1,data:t}),e.props.loadOnlyOnce&&saveDataToCache(e.props.url,e.getUrlParams(),t)}).catch(function(t){e._isMounted&&e.setState({fetchState:-1,error:t.toString()})}).finally(function(){e._isFetching=!1,e.updateView()})})}}},{key:"handleChange",value:function(t){var e=0<arguments.length&&void 0!==t?t:null;this._isMounted&&this.setState({data:null===e?this.state.data:e})}},{key:"updateView",value:function(){"function"==typeof this.props.onViewUpdated&&this.props.onViewUpdated()}},{key:"render",value:function(){return React.createElement(React.Fragment,null,React.createElement(IsLoading,{fetchState:this.state.fetchState},this.props.isLoading),React.createElement(HasError,{fetchState:this.state.fetchState,error:this.state.error},this.props.hasError),React.createElement(IsLoaded,{fetchState:this.state.fetchState,data:this.state.data,params:this.state.params,handleChange:this.handleChange},this.props.isLoaded))}}]),r}();exports.default=JsonData;